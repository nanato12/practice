# 関数呼び出しを含む例

```c
int plus(int x, int y) {
  return x + y;
}

int main() {
  return plus(3, 4);
}
```

このコードに対するアセンブリ

```s
.intel_syntax noprefix
.globl plus, main

plus:
        add rsi, rdi
        mov rax, rsi
        ret

main:
        mov rdi, 3
        mov rsi, 4
        call plus
        ret
```

Cではmainからplusを引数つきで呼び出しています。

アセンブラにおいては、第一引数はRDIレジスタ、第二引数はRSIレジスタに入れるという約束になっているので、mainの最初の2行でそのとおりに値をセットしています。

callというのは関数を呼び出す命令です。具体的にcallは次のことを行います。

- callの次の命令（この場合ret）のアドレスをスタックにプッシュ
- callの引数として与えられたアドレスにジャンプ

addは足し算を行う命令です。
この場合には、RSIレジスタとRDIレジスタを足した結果がRSIレジスタに書き込まれます。
x86-64の整数演算命令は通常2つのレジスタしか受け取らないので、第1引数のレジスタの値を上書きする形で結果が保存されることになります。

関数からの返り値はRAXに入れるということになってました。
したがって足し算の結果はRAXに入れておきたいので、RSIからRAXに値をコピーする必要があります。
ここではmov命令を使ってそれを行なっています。
movはmoveの省略形ですが、実際にはデータを移動するわけではなく単にコピーする命令です。

